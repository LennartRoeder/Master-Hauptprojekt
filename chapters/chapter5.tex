% !TeX spellcheck = en_US

\chapter{Implementation}
This chapter describes the technical problems, how they were overcome during integration into the MARS LIFE system.



\section{Technical limitations}
Implementing the GIS layer was done in a predefined environment. To meet the given requirements certain limitations had to be overcome.\\
The biggest one was the usage of .NET Core in combination with the GIS domain. GIS processing is a very specialized field in computing and is used by a small community. The community has a very domain focused background, rather than a technical one. This being said, the community has settled on two main technologies; python and R.\\
Outside these two languages the number of usable libraries is limited. C\# on the other hand has a big corporate user-base that focuses on big business applications, making it less attractive for people from the GIS domain. As a result library support for C\# is extremely limited. Currently there are only two serious libraries to choose from, namely NetTopologySuite and DotSpatial.\\


\subsection{.NET Core}
.NET Core is a new, implementation of C\# developed by Microsoft. While .NET Core is a very promising technology in terms of performance and platform independence, it still has some shortcomings.\\
The most relevant issue is the absents of core functionality. Classes like \enquote{System.Drawing} which provides general image manipulation is currently missing in .NET Core v1.1. This particular class has been added to the recently published .NET Core 2.0 which improves the situation. However other functionalities used for GIS are still missing.


\subsection{GIS libraries}
As mentioned before, compatibility for GIS libraries is not very good. Since they rely heavily on missing core functionality, it is not trivial to migrate them and as a result compatibility to all GIS libraries, known by the author has been broken by .NET Core.\\
The only library that has been migrated so far is NetTopologySuite. DotSpatial has not been ported yet and the team did not show any intentions to migrate the code base. This is why the AsciiGrid parser has been created as an alternative (see section \ref{sec:parser}).



\section{Integration into LIFE}
The solutions for raster and vector GIS work quite different, as a result two separate layers have been created.


\subsection{Vector GIS Layer -- NetTopologySuite}
NTS is a reimplementation of the JavaTopologySuite written in Java. It supports various vector GIS functionalities. All requirements enlisted in section \ref{sec:requirements} are covered, as well as further functions which might be useful in the future.\\
Since August 2017 the issue for .NET Core 1.1 compatibility has been closed, allowing NTS support for .NET Core.
%Unfortunately the Shapefile compatibility was removed in the current version, due to some reworks. This is currently a blocker for the implementation of the GIS vector layer. If this issue persists, a self made parser for GeoJSON or well-known-text (WKT) like it was done for raster GIS is a valid alternative. In comparison to raster GIS the implementation is more complex.\\


\subsection{Raster GIS Layer -- AsciiGridParser}
\label{sec:parser}
Due to the incompatibility of DotSpatial an alternative solution had to be created to handle raster GIS. With the lack of core libraries that support any kind of image processing supporting GeoTIFF was not worth the effort.\\
To do so, image processing, as well ass certain image compression mechanism would have had to be implemented. Considering the current design, this effort would have been able to speed up initialization time, but not runtime performance. Therefor the text-based Esri AsciiGrid format hast been chosen.\\
AsciiGrid has larger file size, but zip compression can dramatically reduce this size. The conversion into a zipped AsciiGrid is done by the GeoServer on export.\\
The way the parser works is that it opens the data file during the initialization and parses the metadata into local variables and the payload into a multi-dimensional array. This reduces the complex and time consuming portion of the process to a one time operation. Thereafter, reads can be done via index access on the array, which is almost instant, allows millions of reads within milliseconds.\\
The parser offers methods for a more convenient workflow, as specified in section \ref{sec:requirements}. The easiest way to query the raster file is by X and Y coordinates of the desired pixel. It is however more practical to request based on a GPS position. Additionally it is possible to calculate the distance between pixels and GPS position.\\
The parser is fast and easy to use, since it offers a simple and clean interface that is documented and well tested.